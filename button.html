<html>
<head>
  <meta charset="utf-8">
  <script src="http://vlcorp.fr/Icreate/js/three.js"></script>
  <script src="http://vlcorp.fr/Icreate/js/leap-0.6.4.js"></script>
  <script src="http://vlcorp.fr/Icreate/js/leap-plugins-0.1.11pre.js"></script>

  <script src="http://vlcorp.fr/Icreate/js/leap-widgets-0.1.0.js"></script>

  <script src="http://vlcorp.fr/Icreate/js/OrbitControls.js"></script>

  <style>
    body {
      margin: 0;
    }
    canvas.leap-boneHand{
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
    }

    #view-source {
      position: absolute;
      top: 0;
      right: 0;
      margin: 10px;
      z-index: 10;
    }
    video {
        position: fixed;
        right: 0;
        bottom: 0;
        width: 100%;
    }
  </style>

</head>
<body style="background-color:powderblue;">

<a id="view-source" href="#">View Source</a>

<p>Leftmost button locks, rightmost does not.</p>

<video id="video">
    <source src="countdown.mp4" type="video/mp4">
    Sorry, your browser doesn't support embedded videos.
</video>

</body>

<div id="test_action" style="display:none">
  this is a div for testing
</div>

<div id="menu" style="display:none">
<script src="http://code.jquery.com/jquery-1.10.1.min.js"></script>
<script src="/socket.io/socket.io.js"></script>
<script>
  'use strict';

  // Sockets

  var socket = io.connect('http://172.20.10.2:8080');

  // We send it to the server
  socket.emit('identifiant', 0);

  var waterfall = new Audio('waterfall.mp3');
  waterfall.play();

  // We display an alert box when we receive a message
  socket.on('messageFrom', function(id, message) {
      alert(id + ' says : ' + message);
  });

  socket.on('choosedVideo', function(id, video) {
      console.log(id + ' choosed : ' + video);
      var button = document.getElementById('city' + id);
      console.log(button.value);
      button.value = video;
  });

  // Set up plugins

  Leap.loop({host:"172.20.10.5", port: 8081, background: true})
    .use('transform', {
      vr: 'desktop' // Switch to meters.
    })
    .use('boneHand', {
      targetEl: document.body,
      jointColor: new THREE.Color(0xffffff),
      rendererOps: {antialias: true}
    })
    .use('proximity');


  // Set up scene

  var scene = Leap.loopController.plugins.boneHand.scene;
  var camera = Leap.loopController.plugins.boneHand.camera;
  var renderer = Leap.loopController.plugins.boneHand.renderer;
  camera.position.set( 0, 1, 0.6 );

  var controls = new THREE.OrbitControls( camera );
  /*
  var axisHelper = new THREE.AxisHelper( 0.1 );
  scene.add( axisHelper );
  */

  // Add a plane

  var planeGeo = new THREE.PlaneGeometry(0.1, 0.2);
  var material = new THREE.MeshPhongMaterial();
  var buttonMesh = new THREE.Mesh(planeGeo, material);
  var buttonMesh2 = new THREE.Mesh(planeGeo, material);
  var buttonMesh3 = new THREE.Mesh(planeGeo, material);

  // Circular button:
  var circleGeo2 = new THREE.CircleGeometry(0.1, 32);
  buttonMesh2 = new THREE.Mesh(circleGeo2, material.clone());
  buttonMesh2.name = "round button2";

  buttonMesh2.position.set(-0.14, 0.25, -0.1);

  var roundButton2 = new PushButton(
    // for now, constructing with moveX and moveY turned off so that doesn't try and watch for XY intersections,
    // which won't work for circles.
    // todo - have a setter for moveX and moveY, so that proximities can be turned on and off.
    // Note that we have to bind press and release effects to each individual button. This is a long way from CSS rules still.
    new InteractablePlane(buttonMesh2, Leap.loopController, {moveX: false, moveY: false})
  ).on('press', function(mesh){
      socket.emit('playVideo', '1', 4);
      waterfall.pause();
      // We stop the background music while the video is playing
      setTimeout(function(){
          waterfall.play();
      }, 5500);
      mesh.material.color.setHex(0xccccff);
  }).on('release', function(mesh){
    mesh.material.color.setHex(0xffffff);
  });

  var circleGeo3 = new THREE.CircleGeometry(0.1, 32);
  buttonMesh3 = new THREE.Mesh(circleGeo3, material.clone());
  buttonMesh3.name = "round button3";

  buttonMesh3.position.set(0.14, 0.25, -0.1);

  var roundButton3 = new PushButton(
    new InteractablePlane(buttonMesh3, Leap.loopController, {moveX: false, moveY: false})
  ).on('press', function(mesh){
      socket.emit('playVideo', '2', 4);
      waterfall.pause();
      // We stop the background music while the video is playing
      setTimeout(function(){
          waterfall.play();
      }, 5500);
    mesh.material.color.setHex(0xccccff);
  }).on('release', function(mesh){
    mesh.material.color.setHex(0xffffff);
  });

  var circleGeo = new THREE.CircleGeometry(0.1, 32);
  buttonMesh = new THREE.Mesh(circleGeo, material.clone());
  buttonMesh.name = "round button";

  buttonMesh.position.set(0, 0.3, -0.1);
  scene.add(buttonMesh);

  var video = document.getElementById('video');
  function checkTime() {
      if (video.currentTime >= video.duration) {
         video.style.display = 'none';
         scene.remove(buttonMesh);
         scene.add(buttonMesh2);
         scene.add(buttonMesh3);
      // We check if the video has reach the end
      } else {
         // call checkTime every tenth of a second
         setTimeout(checkTime, 100);
      }
  }

  var roundButton = new PushButton(
    // for now, constructing with moveX and moveY turned off so that doesn't try and watch for XY intersections,
    // which won't work for circles.
    // todo - have a setter for moveX and moveY, so that proximities can be turned on and off.
    // Note that we have to bind press and release effects to each individual button. This is a long way from CSS rules still.
    new InteractablePlane(buttonMesh, Leap.loopController, {moveX: false, moveY: false})
  ).on('press', function(mesh){
      scene.remove(buttonMesh);
      video.play();
      checkTime();
  });

  document.getElementById('view-source').href = "view-source:" + window.location.href;
  document.getElementById('view-source').target = "_blank";

</script>
</div>



</html>
